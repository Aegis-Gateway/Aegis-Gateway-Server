services:
    clickhouse:
        image: clickhouse/clickhouse-server:latest
        user: '101:101'
        container_name: clickhouse
        restart: unless-stopped
        hostname: clickhouse
        environment:
            - CLICKHOUSE_DB=proxy
            - CLICKHOUSE_USER=clickhouse
            - CLICKHOUSE_PASSWORD=<YOUR_PASSWORD>
        volumes:
          - ${PWD}/volumes/clickhouse/config.xml:/etc/clickhouse-server/config.d/config.xml
          - ${PWD}/volumes/clickhouse/users.xml:/etc/clickhouse-server/users.d/users.xml
        ports:
          - '3218:8123/tcp'
          - '1238:9000/tcp'
    grafana:
        image: grafana/grafana-enterprise:latest
        container_name: grafana
        restart: unless-stopped
        environment:
            - GF_SECURITY_ADMIN_PASSWORD=<YOUR_PASSWORD>
            - GF_INSTALL_PLUGINS=grafana-clickhouse-datasource
            - GF_SECURITY_ALLOW_EMBEDDING=true
        ports:
            - '5687:3000/tcp'
        volumes:
            - ${PWD}/volumes/grafana/:/etc/grafana/provisioning/datasources
        depends_on:
            - clickhouse
